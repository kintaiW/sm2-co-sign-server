<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SM2 ååŒç­¾åæœåŠ¡ç«¯ - æŠ€æœ¯æ–‡æ¡£</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        header {
            background: linear-gradient(135deg, #00ADD8 0%, #007D9C 100%);
            color: white;
            padding: 60px 20px;
            text-align: center;
        }
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .badges {
            margin-top: 20px;
        }
        .badges img {
            margin: 0 5px;
        }
        nav {
            background: #fff;
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        nav ul {
            list-style: none;
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
        }
        nav li {
            margin: 0 15px;
        }
        nav a {
            text-decoration: none;
            color: #00ADD8;
            font-weight: 500;
            transition: color 0.3s;
        }
        nav a:hover {
            color: #007D9C;
        }
        section {
            background: #fff;
            margin: 20px 0;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h2 {
            color: #00ADD8;
            border-bottom: 2px solid #00ADD8;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        h3 {
            color: #333;
            margin: 20px 0 10px;
        }
        h4 {
            color: #007D9C;
            margin: 15px 0 10px;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .feature-card {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #00ADD8;
        }
        .feature-card h4 {
            color: #00ADD8;
            margin-bottom: 10px;
        }
        .tech-stack {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        .tech-badge {
            background: #00ADD8;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }
        pre {
            background: #2d2d2d;
            color: #f8f8f2;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            margin: 15px 0;
        }
        code {
            font-family: 'Fira Code', 'Consolas', monospace;
        }
        .inline-code {
            background: #e9ecef;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.9em;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background: #00ADD8;
            color: white;
        }
        tr:hover {
            background: #f5f5f5;
        }
        .diagram {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            white-space: pre;
            overflow-x: auto;
            font-size: 0.85em;
            line-height: 1.4;
        }
        .btn {
            display: inline-block;
            background: #00ADD8;
            color: white;
            padding: 10px 25px;
            border-radius: 25px;
            text-decoration: none;
            margin: 5px;
            transition: background 0.3s;
        }
        .btn:hover {
            background: #007D9C;
        }
        .btn-outline {
            background: transparent;
            border: 2px solid #00ADD8;
            color: #00ADD8;
        }
        .btn-outline:hover {
            background: #00ADD8;
            color: white;
        }
        footer {
            text-align: center;
            padding: 40px;
            color: #666;
            border-top: 1px solid #ddd;
        }
        .warning-box {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .info-box {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .go-keyword {
            color: #00ADD8;
            font-weight: bold;
        }
        .architecture-box {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }
            section {
                padding: 20px;
            }
            nav ul {
                flex-direction: column;
                align-items: center;
            }
            nav li {
                margin: 5px 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>ğŸ¹ SM2 ååŒç­¾åæœåŠ¡ç«¯</h1>
        <p>åŸºäº Go è¯­è¨€å®ç°çš„ SM2 ååŒç­¾åæœåŠ¡ç«¯ç¨‹åº</p>
        <div class="badges">
            <img src="https://img.shields.io/badge/License-Apache%202.0-blue.svg" alt="License">
            <img src="https://img.shields.io/badge/Go-1.24-00ADD8?logo=go" alt="Go">
            <img src="https://img.shields.io/badge/Fiber-v2.52-00ADD8" alt="Fiber">
            <img src="https://img.shields.io/badge/gmsm-v0.30-00ADD8" alt="gmsm">
        </div>
    </header>

    <nav>
        <ul>
            <li><a href="#overview">æ¦‚è¿°</a></li>
            <li><a href="#architecture">æ¶æ„è®¾è®¡</a></li>
            <li><a href="#crypto">å¯†ç å­¦å®ç°</a></li>
            <li><a href="#api">API æ¥å£</a></li>
            <li><a href="#deployment">éƒ¨ç½²æŒ‡å—</a></li>
            <li><a href="#security">å®‰å…¨æœºåˆ¶</a></li>
            <li><a href="#license">è®¸å¯è¯</a></li>
        </ul>
    </nav>

    <div class="container">
        <section id="overview">
            <h2>ğŸ“‹ æ¦‚è¿°</h2>
            <p>SM2 ååŒç­¾åæœåŠ¡ç«¯æ˜¯æ•´ä¸ªååŒç­¾åç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ï¼Œè´Ÿè´£ç®¡ç†æœåŠ¡ç«¯å¯†é’¥åˆ†é‡ã€æ‰§è¡ŒååŒç­¾åå’Œè§£å¯†è¿ç®—ã€‚æœåŠ¡ç«¯ä¸å®¢æˆ·ç«¯ååŒå·¥ä½œï¼Œç¡®ä¿å®Œæ•´ç§é’¥æ°¸ä¸å‡ºç°ã€‚</p>
            
            <div class="info-box">
                <strong>æ ¸å¿ƒèŒè´£ï¼š</strong>å­˜å‚¨æœåŠ¡ç«¯å¯†é’¥åˆ†é‡ D2ï¼Œå“åº”å®¢æˆ·ç«¯çš„å¯†é’¥ç”Ÿæˆã€ç­¾åã€è§£å¯†è¯·æ±‚ï¼Œè®°å½•å®¡è®¡æ—¥å¿—ã€‚
            </div>

            <h3>æŠ€æœ¯æ ˆ</h3>
            <div class="tech-stack">
                <span class="tech-badge">Go 1.24</span>
                <span class="tech-badge">Fiber v2.52</span>
                <span class="tech-badge">gmsm v0.30</span>
                <span class="tech-badge">SQLite</span>
                <span class="tech-badge">Viper</span>
            </div>

            <h3>æ ¸å¿ƒä¾èµ–</h3>
            <table>
                <tr>
                    <th>ä¾èµ–</th>
                    <th>ç‰ˆæœ¬</th>
                    <th>ç”¨é€”</th>
                </tr>
                <tr>
                    <td><code>github.com/emmansun/gmsm</code></td>
                    <td>v0.30.0</td>
                    <td>SM2/SM3/SM4 å›½å¯†ç®—æ³•å®ç°</td>
                </tr>
                <tr>
                    <td><code>github.com/gofiber/fiber/v2</code></td>
                    <td>v2.52.6</td>
                    <td>é«˜æ€§èƒ½ HTTP æ¡†æ¶</td>
                </tr>
                <tr>
                    <td><code>modernc.org/sqlite</code></td>
                    <td>v1.34.4</td>
                    <td>çº¯ Go SQLite é©±åŠ¨</td>
                </tr>
                <tr>
                    <td><code>github.com/spf13/viper</code></td>
                    <td>v1.19.0</td>
                    <td>é…ç½®ç®¡ç†</td>
                </tr>
                <tr>
                    <td><code>github.com/google/uuid</code></td>
                    <td>v1.6.0</td>
                    <td>UUID ç”Ÿæˆ</td>
                </tr>
            </table>
        </section>

        <section id="architecture">
            <h2>ğŸ—ï¸ æ¶æ„è®¾è®¡</h2>
            
            <h3>ç›®å½•ç»“æ„</h3>
            <div class="diagram">
backend/
â”œâ”€â”€ cmd/
â”‚   â””â”€â”€ server/
â”‚       â””â”€â”€ main.go              # æœåŠ¡å…¥å£
â”œâ”€â”€ internal/
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go           # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ crypto/
â”‚   â”‚   â””â”€â”€ sm2_coop.go         # SM2 ååŒç®—æ³•æ ¸å¿ƒ
â”‚   â”œâ”€â”€ handler/
â”‚   â”‚   â”œâ”€â”€ cosign.go           # ååŒç­¾åå¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ user.go             # ç”¨æˆ·å¤„ç†å™¨
â”‚   â”‚   â””â”€â”€ admin.go            # ç®¡ç†å¤„ç†å™¨
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â””â”€â”€ auth.go             # è®¤è¯ä¸­é—´ä»¶
â”‚   â”œâ”€â”€ model/
â”‚   â”‚   â”œâ”€â”€ user.go             # ç”¨æˆ·æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ key.go              # å¯†é’¥æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ session.go          # ä¼šè¯æ¨¡å‹
â”‚   â”‚   â””â”€â”€ audit_log.go        # å®¡è®¡æ—¥å¿—æ¨¡å‹
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ repository.go       # æ•°æ®åº“è¿æ¥
â”‚   â”‚   â”œâ”€â”€ user_repo.go        # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”‚   â”œâ”€â”€ key_repo.go         # å¯†é’¥æ•°æ®è®¿é—®
â”‚   â”‚   â””â”€â”€ audit_log_repo.go   # å®¡è®¡æ—¥å¿—æ•°æ®è®¿é—®
â”‚   â””â”€â”€ service/
â”‚       â”œâ”€â”€ cosign_service.go   # ååŒç­¾åæœåŠ¡
â”‚       â”œâ”€â”€ user_service.go     # ç”¨æˆ·æœåŠ¡
â”‚       â””â”€â”€ admin_init.go       # ç®¡ç†å‘˜åˆå§‹åŒ–
â”œâ”€â”€ pkg/
â”‚   â”œâ”€â”€ response/
â”‚   â”‚   â””â”€â”€ response.go         # ç»Ÿä¸€å“åº”æ ¼å¼
â”‚   â””â”€â”€ utils/
â”‚       â””â”€â”€ utils.go            # å·¥å…·å‡½æ•°
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ api.md                  # API æ–‡æ¡£
â”‚   â””â”€â”€ api.yaml                # OpenAPI è§„èŒƒ
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ schema.sql              # æ•°æ®åº“ Schema
â”œâ”€â”€ config.yaml                 # é…ç½®æ–‡ä»¶
â”œâ”€â”€ go.mod
â””â”€â”€ go.sum
            </div>

            <h3>åˆ†å±‚æ¶æ„</h3>
            <div class="architecture-box">
                <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    HTTP Handler å±‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ UserHandler â”‚  â”‚CosignHandlerâ”‚  â”‚AdminHandler â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚
          â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Service å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚ UserService â”‚  â”‚CosignServiceâ”‚  â”‚AdminService â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚
          â–¼                â–¼                â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Repository å±‚                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  UserRepo   â”‚  â”‚   KeyRepo   â”‚  â”‚ AuditLogRepoâ”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                â”‚                â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SQLite æ•°æ®åº“                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                </div>
            </div>

            <h3>æ•°æ®æ¨¡å‹</h3>
            <h4>User ç”¨æˆ·æ¨¡å‹</h4>
            <table>
                <tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr>
                <tr><td>ID</td><td>string</td><td>ç”¨æˆ·å”¯ä¸€æ ‡è¯† (UUID)</td></tr>
                <tr><td>Username</td><td>string</td><td>ç”¨æˆ·å</td></tr>
                <tr><td>PasswordHash</td><td>string</td><td>å¯†ç å“ˆå¸Œ (SM3)</td></tr>
                <tr><td>PublicKey</td><td>string</td><td>ååŒå…¬é’¥ (Base64)</td></tr>
                <tr><td>Status</td><td>int</td><td>çŠ¶æ€ (0=ç¦ç”¨, 1=å¯ç”¨)</td></tr>
                <tr><td>CreatedAt</td><td>time.Time</td><td>åˆ›å»ºæ—¶é—´</td></tr>
            </table>

            <h4>Key å¯†é’¥æ¨¡å‹</h4>
            <table>
                <tr><th>å­—æ®µ</th><th>ç±»å‹</th><th>æè¿°</th></tr>
                <tr><td>ID</td><td>string</td><td>å¯†é’¥å”¯ä¸€æ ‡è¯† (UUID)</td></tr>
                <tr><td>UserID</td><td>string</td><td>å…³è”ç”¨æˆ· ID</td></tr>
                <tr><td>D2</td><td>string</td><td>æœåŠ¡ç«¯ç§é’¥åˆ†é‡ (Base64, ä¸å¯¹å¤–æš´éœ²)</td></tr>
                <tr><td>D2Inv</td><td>string</td><td>D2 çš„é€†å…ƒ (Base64, ä¸å¯¹å¤–æš´éœ²)</td></tr>
                <tr><td>PublicKey</td><td>string</td><td>ååŒå…¬é’¥ (Base64)</td></tr>
                <tr><td>Status</td><td>int</td><td>çŠ¶æ€ (0=ç¦ç”¨, 1=å¯ç”¨)</td></tr>
            </table>
        </section>

        <section id="crypto">
            <h2>ğŸ” å¯†ç å­¦å®ç°</h2>
            
            <h3>SM2 ååŒå¯†é’¥ç”Ÿæˆ</h3>
            <p>æœåŠ¡ç«¯æ¥æ”¶å®¢æˆ·ç«¯çš„å…¬é’¥åˆ†é‡ P1ï¼Œç”ŸæˆæœåŠ¡ç«¯å¯†é’¥åˆ†é‡ D2ï¼Œè®¡ç®—ååŒå…¬é’¥ Paã€‚</p>
            
            <div class="diagram">
func CoopKeyGenInit(p1 []byte) (*SM2CoopKeyGenResult, error) {
    // 1. è§£æ P1 ä¸ºæ¤­åœ†æ›²çº¿ç‚¹
    p1X := new(big.Int).SetBytes(p1[:32])
    p1Y := new(big.Int).SetBytes(p1[32:64])
    
    // 2. ç”Ÿæˆéšæœº d2 (æœåŠ¡ç«¯ç§é’¥åˆ†é‡)
    d2, _ := rand.Int(rand.Reader, N)
    
    // 3. è®¡ç®— d2Inv = d2^(-1) mod n
    d2Inv := new(big.Int).ModInverse(d2, N)
    
    // 4. è®¡ç®— P2 = d2Inv * G
    p2X, p2Y := SM2Curve.ScalarBaseMult(d2Inv.Bytes())
    
    // 5. è®¡ç®— Pa = d2Inv * P1 + (n-1) * G
    //    ç­‰ä»·äº Pa = d2Inv * P1 - G
    paX, paY := SM2Curve.ScalarMult(p1X, p1Y, d2Inv.Bytes())
    minusOne := new(big.Int).Sub(N, big.NewInt(1))
    gX, gY := SM2Curve.ScalarBaseMult(minusOne.Bytes())
    paX, paY = SM2Curve.Add(paX, paY, gX, gY)
    
    return &SM2CoopKeyGenResult{D2, D2Inv, P2, Pa}, nil
}
            </div>

            <h3>æ•°å­¦å…³ç³»</h3>
            <div class="info-box">
                <strong>å®Œæ•´ç§é’¥ï¼š</strong>d = d1 Ã— d2 - 1 (mod n)<br>
                <strong>ååŒå…¬é’¥ï¼š</strong>Pa = d2Inv Ã— P1 - G = d Ã— G<br>
                <strong>éªŒè¯ï¼š</strong>Pa = d2Inv Ã— d1 Ã— G - G = (d1 Ã— d2Inv - 1) Ã— G = d Ã— G
            </div>

            <h3>SM2 ååŒç­¾å</h3>
            <div class="diagram">
func CoopSign(d2Inv, q1, e []byte) (*SM2CoopSignResult, error) {
    // 1. è§£æ Q1 ä¸ºæ¤­åœ†æ›²çº¿ç‚¹
    q1X := new(big.Int).SetBytes(q1[:32])
    q1Y := new(big.Int).SetBytes(q1[32:64])
    
    // 2. ç”Ÿæˆéšæœº k2, k3
    k2, _ := rand.Int(rand.Reader, N)
    k3, _ := rand.Int(rand.Reader, N)
    
    // 3. è®¡ç®— Q2 = k2 * G
    q2X, q2Y := SM2Curve.ScalarBaseMult(k2.Bytes())
    
    // 4. è®¡ç®— x1 = k3 * Q1 + Q2
    x1X, x1Y := SM2Curve.ScalarMult(q1X, q1Y, k3.Bytes())
    x1X, x1Y = SM2Curve.Add(x1X, x1Y, q2X, q2Y)
    
    // 5. è®¡ç®— r = (e + x1) mod n
    r := new(big.Int).SetBytes(e)
    r.Add(r, x1X).Mod(r, N)
    
    // 6. è®¡ç®— s2 = d2Inv * k3 mod n
    s2 := new(big.Int).Mul(d2InvBig, k3).Mod(r, N)
    
    // 7. è®¡ç®— s3 = d2Inv * (r + k2) mod n
    s3 := new(big.Int).Mul(d2InvBig, rPlusK2).Mod(r, N)
    
    return &SM2CoopSignResult{R, S2, S3}, nil
}
            </div>

            <h3>SM2 ååŒè§£å¯†</h3>
            <div class="diagram">
func CoopDecrypt(d2Inv, t1 []byte) ([]byte, error) {
    // 1. è§£æ T1 ä¸ºæ¤­åœ†æ›²çº¿ç‚¹
    t1X := new(big.Int).SetBytes(t1[:32])
    t1Y := new(big.Int).SetBytes(t1[32:64])
    
    // 2. è®¡ç®— T2 = d2Inv * T1
    t2X, t2Y := SM2Curve.ScalarMult(t1X, t1Y, d2Inv)
    
    // 3. è¿”å› T2 ç»™å®¢æˆ·ç«¯
    return t2, nil
}
            </div>
        </section>

        <section id="api">
            <h2>ğŸ“¡ API æ¥å£</h2>
            
            <h3>è·¯ç”±é…ç½®</h3>
            <div class="diagram">
// ä¸šåŠ¡æ¥å£ (/api/*)
api.Post("/register", userHandler.Register)    // ç”¨æˆ·æ³¨å†Œ
api.Post("/login", userHandler.Login)          // ç”¨æˆ·ç™»å½•
api.Post("/logout", userHandler.Logout)        // ç”¨æˆ·ç™»å‡º

// è®¤è¯æ¥å£ (éœ€è¦ Bearer Token)
authGroup.Get("/user/info", userHandler.GetUserInfo)
authGroup.Post("/key/init", cosignHandler.KeyInit)  // å¯†é’¥åˆå§‹åŒ–
authGroup.Post("/sign", cosignHandler.Sign)         // ååŒç­¾å
authGroup.Post("/decrypt", cosignHandler.Decrypt)   // ååŒè§£å¯†

// ç®¡ç†æ¥å£ (/mapi/*)
mapi.Get("/health", adminHandler.Health)
mapi.Get("/stats", adminHandler.Stats)
mapi.Get("/users", adminHandler.ListUsers)
mapi.Get("/users/:id", adminHandler.GetUser)
mapi.Delete("/users/:id", adminHandler.DeleteUser)
mapi.Put("/users/:id/status", adminHandler.UpdateUserStatus)
mapi.Get("/keys", adminHandler.ListKeys)
mapi.Delete("/keys/:id", adminHandler.DeleteKey)
mapi.Get("/logs", adminHandler.ListLogs)
            </div>

            <h3>ååŒç­¾åæ¥å£</h3>
            <h4>POST /api/sign</h4>
            <p><strong>è¯·æ±‚ä½“ï¼š</strong></p>
            <pre><code>{
    "q1": "Base64ç¼–ç çš„Q1 (64å­—èŠ‚)",
    "e": "Base64ç¼–ç çš„æ¶ˆæ¯å“ˆå¸Œ (32å­—èŠ‚)"
}</code></pre>
            <p><strong>å“åº”ï¼š</strong></p>
            <pre><code>{
    "code": 0,
    "message": "success",
    "data": {
        "r": "Base64ç¼–ç çš„ç­¾ååˆ†é‡r",
        "s2": "Base64ç¼–ç çš„ç­¾ååˆ†é‡s2",
        "s3": "Base64ç¼–ç çš„ç­¾ååˆ†é‡s3"
    }
}</code></pre>

            <h3>é”™è¯¯ç å®šä¹‰</h3>
            <table>
                <tr><th>é”™è¯¯ç </th><th>æè¿°</th></tr>
                <tr><td>0</td><td>æˆåŠŸ</td></tr>
                <tr><td>10001</td><td>ç”¨æˆ·åå·²å­˜åœ¨</td></tr>
                <tr><td>10002</td><td>ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯</td></tr>
                <tr><td>10003</td><td>Token æ— æ•ˆæˆ–å·²è¿‡æœŸ</td></tr>
                <tr><td>10004</td><td>æƒé™ä¸è¶³</td></tr>
                <tr><td>10005</td><td>å‚æ•°é”™è¯¯</td></tr>
                <tr><td>10006</td><td>å¯†é’¥ç”Ÿæˆå¤±è´¥</td></tr>
                <tr><td>10007</td><td>ç­¾åå¤±è´¥</td></tr>
                <tr><td>10008</td><td>è§£å¯†å¤±è´¥</td></tr>
            </table>
        </section>

        <section id="deployment">
            <h2>ğŸš€ éƒ¨ç½²æŒ‡å—</h2>
            
            <h3>é…ç½®æ–‡ä»¶ (config.yaml)</h3>
            <pre><code># SM2 ååŒç­¾åæœåŠ¡é…ç½®
server:
  port: 9002
  read_timeout: 30s
  write_timeout: 30s

database:
  path: ./data/cosign.db

auth:
  token_expire: 24h
  master_key: ""

log:
  level: info
  output: stdout

admin:
  username: ""
  password: ""</code></pre>

            <h3>å¯åŠ¨æœåŠ¡</h3>
            <pre><code># å¼€å‘æ¨¡å¼
go run cmd/server/main.go

# æŒ‡å®šé…ç½®æ–‡ä»¶
go run cmd/server/main.go /path/to/config.yaml

# ç¼–è¯‘åè¿è¡Œ
go build -o bin/sm2-co-sign-server ./cmd/server
./bin/sm2-co-sign-server</code></pre>

            <h3>å¥åº·æ£€æŸ¥</h3>
            <pre><code>curl http://localhost:9002/mapi/health</code></pre>

            <div class="warning-box">
                <strong>âš ï¸ å®‰å…¨æç¤ºï¼š</strong>
                <ul>
                    <li>ç”Ÿäº§ç¯å¢ƒå¿…é¡»é…ç½® HTTPS</li>
                    <li>è®¾ç½®å¼ºå¯†ç çš„ç®¡ç†å‘˜è´¦æˆ·</li>
                    <li>é…ç½®é€‚å½“çš„ master_key</li>
                    <li>å®šæœŸå¤‡ä»½ SQLite æ•°æ®åº“</li>
                </ul>
            </div>
        </section>

        <section id="security">
            <h2>ğŸ›¡ï¸ å®‰å…¨æœºåˆ¶</h2>
            
            <h3>å¯†é’¥éš”ç¦»</h3>
            <div class="feature-grid">
                <div class="feature-card">
                    <h4>ğŸ”‘ D2 ä¿æŠ¤</h4>
                    <p>æœåŠ¡ç«¯ç§é’¥åˆ†é‡ D2 å’Œ D2Inv å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œä¸é€šè¿‡ API æš´éœ²ã€‚</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ« Token è®¤è¯</h4>
                    <p>ä½¿ç”¨ Bearer Token è¿›è¡Œèº«ä»½è®¤è¯ï¼ŒToken æœ‰æ•ˆæœŸå¯é…ç½®ã€‚</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ“ å®¡è®¡æ—¥å¿—</h4>
                    <p>æ‰€æœ‰å…³é”®æ“ä½œï¼ˆå¯†é’¥ç”Ÿæˆã€ç­¾åã€è§£å¯†ï¼‰è®°å½•å®¡è®¡æ—¥å¿—ã€‚</p>
                </div>
                <div class="feature-card">
                    <h4>ğŸ”’ å¯†ç å“ˆå¸Œ</h4>
                    <p>ç”¨æˆ·å¯†ç ä½¿ç”¨ SM3 åŠ ç›å“ˆå¸Œå­˜å‚¨ï¼Œä¸å­˜å‚¨æ˜æ–‡å¯†ç ã€‚</p>
                </div>
            </div>

            <h3>å®‰å…¨æµç¨‹</h3>
            <div class="diagram">
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      å®‰å…¨æ¶æ„                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  å®¢æˆ·ç«¯ (D1)              æœåŠ¡ç«¯ (D2)                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚  â”‚  d1     â”‚              â”‚  d2     â”‚ â† æ•°æ®åº“åŠ å¯†å­˜å‚¨       â”‚
â”‚  â”‚ (ç§é’¥åˆ†é‡)â”‚              â”‚ (ç§é’¥åˆ†é‡)â”‚                       â”‚
â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                       â”‚
â”‚       â”‚                        â”‚                            â”‚
â”‚       â”‚    ååŒç­¾å/è§£å¯†        â”‚                            â”‚
â”‚       â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                            â”‚
â”‚       â”‚                        â”‚                            â”‚
â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                â–¼                                            â”‚
â”‚         å®Œæ•´ç§é’¥ d = d1 Ã— d2 - 1 (æ°¸ä¸å‡ºç°)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            </div>
        </section>

        <section id="license">
            <h2>ğŸ“„ è®¸å¯è¯</h2>
            <p>æœ¬é¡¹ç›®é‡‡ç”¨ <a href="https://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a> è®¸å¯è¯ã€‚</p>
            
            <h3>ç›¸å…³é“¾æ¥</h3>
            <p>
                <a href="https://github.com/kintaiW/sm2-co-sign-server" class="btn">GitHub ä»“åº“</a>
                <a href="https://github.com/kintaiW/sm2-co-sign" class="btn btn-outline">ä¸»é¡¹ç›®</a>
                <a href="https://github.com/kintaiW/sm2-co-sign-client" class="btn btn-outline">å®¢æˆ·ç«¯</a>
            </p>
        </section>
    </div>

    <footer>
        <p>&copy; 2024-2026 SM2 Co-Sign Team. Apache License 2.0</p>
        <p>
            <a href="https://github.com/kintaiW/sm2-co-sign-server">GitHub</a> | 
            <a href="https://github.com/kintaiW/sm2-co-sign-server/issues">Issues</a>
        </p>
    </footer>
</body>
</html>
